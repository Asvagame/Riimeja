const levels = [
    {
        mainImage: 'images/paakuva1.avif',
        mainSound: 'audio/paakuva1.mp3',
        options: [
            { image: 'images/kuva1_1.avif', sound: 'audio/kuva1_1.mp3' },
            { image: 'images/kuva2_1.avif', sound: 'audio/kuva2_1.mp3' },
            { image: 'images/kuva3_1.avif', sound: 'audio/kuva3_1.mp3' }
        ],
        correctOption: 'images/kuva3_1.avif'
    },
    {
        mainImage: 'images/paakuva2.avif',
        mainSound: 'audio/paakuva2.mp3',
        options: [
            { image: 'images/kuva1_2.avif', sound: 'audio/kuva1_2.mp3' },
            { image: 'images/kuva2_2.avif', sound: 'audio/kuva2_2.mp3' },
            { image: 'images/kuva3_2.avif', sound: 'audio/kuva3_2.mp3' }
        ],
        correctOption: 'images/kuva2_2.avif'
    },
    {
        mainImage: 'images/paakuva3.avif',
        mainSound: 'audio/paakuva3.mp3',
        options: [
            { image: 'images/kuva1_3.avif', sound: 'audio/kuva1_3.mp3' },
            { image: 'images/kuva2_3.avif', sound: 'audio/kuva2_3.mp3' },
            { image: 'images/kuva3_3.avif', sound: 'audio/kuva3_3.mp3' }
        ],
        correctOption: 'images/kuva2_3.avif'
    },
    {
        mainImage: 'images/paakuva4.avif',
        mainSound: 'audio/paakuva4.mp3',
        options: [
            { image: 'images/kuva1_4.avif', sound: 'audio/kuva1_4.mp3' },
            { image: 'images/kuva2_4.avif', sound: 'audio/kuva2_4.mp3' },
            { image: 'images/kuva3_4.avif', sound: 'audio/kuva3_4.mp3' }
        ],
        correctOption: 'images/kuva1_4.avif'
    },
    {
        mainImage: 'images/paakuva5.avif',
        mainSound: 'audio/paakuva5.mp3',
        options: [
            { image: 'images/kuva1_5.avif', sound: 'audio/kuva1_5.mp3' },
            { image: 'images/kuva2_5.avif', sound: 'audio/kuva2_5.mp3' },
            { image: 'images/kuva3_5.avif', sound: 'audio/kuva3_5.mp3' }
        ],
        correctOption: 'images/kuva1_5.avif'
    },
    {
        mainImage: 'images/paakuva6.avif',
        mainSound: 'audio/paakuva6.mp3',
        options: [
            { image: 'images/kuva1_6.avif', sound: 'audio/kuva1_6.mp3' },
            { image: 'images/kuva2_6.avif', sound: 'audio/kuva2_6.mp3' },
            { image: 'images/kuva3_6.avif', sound: 'audio/kuva3_6.mp3' }
        ],
        correctOption: 'images/kuva2_6.avif'
    },
    {
        mainImage: 'images/paakuva7.avif',
        mainSound: 'audio/paakuva7.mp3',
        options: [
            { image: 'images/kuva1_7.avif', sound: 'audio/kuva1_7.mp3' },
            { image: 'images/kuva2_7.avif', sound: 'audio/kuva2_7.mp3' },
            { image: 'images/kuva3_7.avif', sound: 'audio/kuva3_7.mp3' }
        ],
        correctOption: 'images/kuva3_7.avif'
    },
    {
        mainImage: 'images/paakuva8.avif',
        mainSound: 'audio/paakuva8.mp3',
        options: [
            { image: 'images/kuva1_8.avif', sound: 'audio/kuva1_8.mp3' },
            { image: 'images/kuva2_8.avif', sound: 'audio/kuva2_8.mp3' },
            { image: 'images/kuva3_8.avif', sound: 'audio/kuva3_8.mp3' }
        ],
        correctOption: 'images/kuva1_8.avif'
    },
    {
        mainImage: 'images/paakuva9.avif',
        mainSound: 'audio/paakuva9.mp3',
        options: [
            { image: 'images/kuva1_9.avif', sound: 'audio/kuva1_9.mp3' },
            { image: 'images/kuva2_9.avif', sound: 'audio/kuva2_9.mp3' },
            { image: 'images/kuva3_9.avif', sound: 'audio/kuva3_9.mp3' }
        ],
        correctOption: 'images/kuva3_9.avif'
    },
    {
        mainImage: 'images/paakuva10.avif',
        mainSound: 'audio/paakuva10.mp3',
        options: [
            { image: 'images/kuva1_10.avif', sound: 'audio/kuva1_10.mp3' },
            { image: 'images/kuva2_10.avif', sound: 'audio/kuva2_10.mp3' },
            { image: 'images/kuva3_10.avif', sound: 'audio/kuva3_10.mp3' }
        ],
        correctOption: 'images/kuva2_10.avif'
    },
    {
        mainImage: 'images/paakuva11.avif',
        mainSound: 'audio/paakuva11.mp3',
        options: [
            { image: 'images/kuva1_11.avif', sound: 'audio/kuva1_11.mp3' },
            { image: 'images/kuva2_11.avif', sound: 'audio/kuva2_11.mp3' },
            { image: 'images/kuva3_11.avif', sound: 'audio/kuva3_11.mp3' }
        ],
        correctOption: 'images/kuva2_11.avif'
    },
    {
        mainImage: 'images/paakuva12.avif',
        mainSound: 'audio/paakuva12.mp3',
        options: [
            { image: 'images/kuva1_12.avif', sound: 'audio/kuva1_12.mp3' },
            { image: 'images/kuva2_12.avif', sound: 'audio/kuva2_12.mp3' },
            { image: 'images/kuva3_12.avif', sound: 'audio/kuva3_12.mp3' }
        ],
        correctOption: 'images/kuva1_12.avif'
    }
];

let currentQuestions = [];
let currentQuestion = 0;
let selectedOption = 0;
let correctAnswers = 0;
let checkButtonClicked = false;
let endAudio;

function startGame() {
    document.getElementById('start-screen').style.display = 'none';
    document.getElementById('question-container').style.display = 'block';
    document.getElementById('stars-container').style.visibility = 'visible';
    currentQuestions = getRandomQuestions(5);
    loadQuestion();
}

function getRandomQuestions(count) {
    const shuffled = [...levels].sort(() => 0.5 - Math.random());
    return shuffled.slice(0, count);
}

function loadQuestion() {
    const question = currentQuestions[currentQuestion];
    document.getElementById('paakuva').src = question.mainImage;
    document.getElementById('option1').src = question.options[0].image;
    document.getElementById('option2').src = question.options[1].image;
    document.getElementById('option3').src = question.options[2].image;
    document.getElementById('next-arrow').style.display = 'none';
    document.getElementById('check-button').style.opacity = '1';
    document.getElementById('check-button').style.cursor = 'pointer';
    checkButtonClicked = false;

    setTimeout(() => playAudio('main'), 100);
}

function selectOption(option) {
    selectedOption = option;
    const options = document.querySelectorAll('.option');
    options.forEach(optionElement => {
        optionElement.classList.remove('selected');
    });
    document.getElementById(`option${option}`).classList.add('selected');
    playAudio(option.toString());
}

function checkAnswer() {
    if (checkButtonClicked) return;
    
    checkButtonClicked = true;
    const question = currentQuestions[currentQuestion];
    if (document.getElementById(`option${selectedOption}`).src.includes(question.correctOption)) {
        document.getElementById(`option${selectedOption}`).classList.add('correct');
        correctAnswers++;
        updateStars(); 
        console.log("Correct answer, stars updated");
    } else {
        document.getElementById(`option${selectedOption}`).classList.add('incorrect');
        document.querySelector(`[src*="${question.correctOption}"]`).classList.add('correct');
    }
    document.getElementById('next-arrow').style.display = 'block';
    document.getElementById('check-button').style.opacity = '0.5';
    document.getElementById('check-button').style.cursor = 'default';
}

function updateStars() {
    const starsContainer = document.getElementById('stars-container');
    starsContainer.innerHTML = '';
    for (let i = 0; i < correctAnswers; i++) {
        const starImg = document.createElement('img');
        starImg.src = 'images/tahti.avif';
        starImg.alt = 't채hti';
        starImg.className = 'star-icon';
        starsContainer.appendChild(starImg);
    }
}

function nextQuestion() {
    const options = document.querySelectorAll('.option');
    options.forEach(option => {
        option.classList.remove('correct', 'incorrect', 'selected');
    });
    currentQuestion++;
    if (currentQuestion >= currentQuestions.length) {
        showResult();
    } else {
        selectedOption = 0;
        loadQuestion();
    }
}

function showResult() {
    let starsHtml = '';
    for (let i = 0; i < correctAnswers; i++) {
        starsHtml += '<img src="images/tahti.avif" alt="t채hti" class="star-icon">';
    }
    
    document.getElementById('question-container').innerHTML = `
        <p id="result">SAIT ${correctAnswers} / ${currentQuestions.length} OIKEIN</p>
        <div id="final-stars-container">${starsHtml}</div>
        <button onclick="restartGame()" style="background-color: transparent; color: black; border: 2px solid black; margin-top: 20px;">PELAA UUDELLEEN</button>
    `;
    document.getElementById('stars-container').style.display = 'none';
    endAudio = new Audio('audio/loppu.mp3');
    endAudio.play();
}

function restartGame() {
    if (endAudio) {
        endAudio.pause();
        endAudio.currentTime = 0;
    }
    
    currentQuestion = 0;
    selectedOption = 0;
    correctAnswers = 0;
    checkButtonClicked = false;
    currentQuestions = getRandomQuestions(5);
    document.getElementById('question-container').innerHTML = `
        <h1>ETSI RIIMIPARI SANALLE:</h1>
        <img id="paakuva" src="" alt="P채채kuva" class="main-image" onclick="playAudio('main')">
        <div class="options">
            <img id="option1" class="option" onclick="selectOption(1)">
            <img id="option2" class="option" onclick="selectOption(2)">
            <img id="option3" class="option" onclick="selectOption(3)">
        </div>
        <button id="check-button" onclick="checkAnswer()">TARKISTA</button>
        <img id="next-arrow" src="images/nuoli.avif" onclick="nextQuestion()">
    `;
    document.getElementById('stars-container').innerHTML = '';
    document.getElementById('stars-container').style.display = 'block';
    loadQuestion();
}

function playAudio(type) {
    const question = currentQuestions[currentQuestion];
    let audio;
    if (type === 'main') {
        audio = new Audio(question.mainSound);
    } else {
        const optionIndex = parseInt(type) - 1;
        audio = new Audio(question.options[optionIndex].sound);
    }
    audio.play();
}

document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('start-button').addEventListener('click', startGame);

    document.addEventListener('keydown', (event) => {
        if (event.key === 'ArrowRight' && document.getElementById('next-arrow').style.display !== 'none') {
            nextQuestion();
        }
    });
});